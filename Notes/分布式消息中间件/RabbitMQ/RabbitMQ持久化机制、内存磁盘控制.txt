RabbitMQ的持久化分为队列持久化、消息持久化和交换器持久化
不管是持久化的消息还是非持久化的消息都可以被写入到磁盘

队列持久化
在定义队列时的durable参数实现，durable为true时，队列才会持久化

消息持久化
通过消息的属性deliveryMode来设置是否持久化，在发送消息时通过basicPublish的参数传入

交换器持久化
定义时设置持久化标识，否则在Broker重启后将丢失

RabbitMQ内存控制
当内存使用超过内存阈值，RabbitMQ会暂时阻止客户端连接，并停止接收客户端消息，避免服务崩溃，客户端与服务的的心跳检测也会失败
rabbitmqctl set_vm_memory_high_watermark<fraction>

内存阈值默认0.4，表示当RabbitMQ使用的内存超过40%时，就会产生告警并阻塞所有生产者连接
通过此命令修改的阈值在Broker重启后将会失效，通过修改配置文件的方式设置阈值则不会在重启后消失，但需要重启Broker才会生效
配置文件地址:/etc/rabbitmq/rabbitmq.conf
vm_memory_high_watermark.relative=0.4
建议0.4-0.66之间，不建议超过0.7

内存换页
某个Broke几点触及内存并阻塞生产者之前，会尝试将队列中的消息换页到磁盘以释放内存
默认在内存达到内存阈值50%时会进行换页操作
即当默认内存阈值0.4的情况下，当内存超过0.4*0.5=0.2时会进行换页操作

RabbitMQ磁盘控制
当磁盘剩余空间低于确定的阈值时，
默认磁盘阈值为50MB，会阻塞生产者并停止内存中消息的换页动作
一个谨慎的做法是讲磁盘阈值设置为与操作系统所显示的内存大小一致
10s检测一次
disk_free_limit.relative=2.0