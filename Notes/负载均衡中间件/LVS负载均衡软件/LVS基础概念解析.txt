一、LVS简介
Linux Virtual Server，即Linux虚拟机服务器。
是我们国家的章文嵩博士的一个开源项目。
在Linux内核2.6中，已经成为内核的一部分，在此之前的内核版本则需要重新编译内核
LVS主要用于多服务器的负载均衡。工作在网络4层，可实现高性能，高可用的服务器集群技术。
廉价，可把许多低性能服务器组合在一起形成一个超级服务器。易用，配置简单，且有多种负载均衡的方法。
稳定可靠，即使集群中的服务器中某台服务器无法正常工作，也不影响整体效果
扩展性好。

二、Linux Virtual Server项目
针对高可伸缩、高可用网络服务的需求，我们给出了基于IP层和基于内容请求分发的负载均衡调度解决办法，并在Linux内核中实现了这些方法
将一组服务器构成一个实现可伸缩的、高可用网络服务的虚拟服务器

虚拟服务器的体系结构：一组服务器通过高速的局域网或者地理分布的广域网相互连接，在它们的前端有一个负载均衡器（Load Balance）
负载均衡调度器能无缝的将网络请求调度到真实服务器上，从而使得服务器集群的结构对客户是透明的
客户访问件系统提供的网络服务就像访问一台高性能、高可用的服务器一样。由于我们的负载调度技术是在Linux内核中实现的，
我们称之为Linux虚拟服务器

三、网络分层
OSI七层协议模型：
应用层
表示层
会话层
传输层
网络层
数据链路层
物理层
Nginx工作在7层网络模型下

网络5层：应用层、运输层、网络层、数据链路层和物理层
5层只是OSI和TCP/IP的综合，是业界生产出来的非官方协议模型，但是很多具体的应用。
实际应用还是TCP/IP的4层结构

网络4层：应用层、运输层、网际层和网络接口层
LVS工作在4层网络模型下

四、IP虚拟服务器软件
在调度器的实现技术中，IP负载均衡技术是效率最高的，IPVS软件实现了三种IP负载均衡技术
Virtual Server via Direct Routing
VS/DR
VS/DR通过改写报文的Mac地址，将请求发送到真是服务器，而真实服务器将响应直接返回给客户。同VS/TUN技术一样，
VS/DR技术极大地提高集群系统的伸缩性。这种方法没有IP隧道的开销，对集群中的真实服务器也没有必须支持IP隧道协议的要
但是要求调度器与真实服务器都有一块网卡连在同一物理网段上。

VS/NAT
通过网络地址转换，调度器重写请求报文的目标地址，根据预设的调度算法，将请求分派给后端的真实服务器；
真实服务器的响应报文通过调度器时，报文的源地址被重写，再返回给客户，完成整个负载调度过程。

VS/TUN
采用NAT技术时，由于请求和响应报文都必须经过调度器地址重写，当客户请求越来越多时，调度器的处理能力将称为瓶颈。
为了解决这个问题，调度器把请求报文通过IP隧道转发至真实服务器，而真实服务器将响应直接返回给客户，所以调度器只处理了请求报文。
由于一般完了服务应答比请求报文大许多，采用VS/TUN技术后，集群系统的最大吞吐量可以提高10倍

五、IP调度算法
IPVS调度算法
针对不同的网络服务需求和服务器配置，IPVS调度器实现了如下八种负载调度算法：
轮询
加权轮询
最少链接
加权最少链接
基于局部性的最少链接
带复制的基于局部性最少链接
目标地址散列
源地址散列

六、内核Layer-7交换机KTCPVS
当一个TCP连接的初始SYN报文到达时，调度器就选择一台服务器，将报文转发给它。
此后通过查发报文的IP和TCP报文头地址，保证此链接的后继报文被转发到该服务器。
这样，IPVS无法检查到请求的内容再选择服务器，这就要求后端服务器组提供相同的服务，不管请求被发往哪台服务器，返回结果都是一样的。
但是，有些应用中后端服务器功能不一，有的提供HTML文档，有的提供图片/CGI，这就需要机遇内容的调度（Content-Based Scheduling）

由于用户控件TCP Gateway开销太大，提出操作系统的内核中实现Layer-7交换方法，避免用户空间的切换和内存复制的开销。
在Linux操作系统的内核中，实现了Layer-7交换，称之为KTCPVS（Kernel TCP Virtual Server）

七、LVS集群特点
功能性：
1.有实现三种IP负载均衡技术和八种连接调度算法的IPVS软件
2.在IPVS内部实现上，采用了搞笑的Hash函数和垃圾回收机制，能正确处理所调度报文相关的ICMP消息
3.虚拟服务的设置数目没有限制，每个虚拟服务有自己的服务器集
4.它支持持久的虚拟服务（如HTTP Cookie和HTTPS等需要该功能的支持），并提供详尽的统计数据，如连接的处理速率和报文的流量等。
5.针对大规模拒绝服务攻击，实现了三种防卫策略
6.有基于内容请求分发的应用层交换软件KTCPVS，也是在Linux内核中实现
7.有相关集群管理软件对资源进行监测，能及时将故障屏蔽，实现系统的高可用性
8.主、从调度器能够周期性地进行状态同步，从而实现更高的可用性
适应性：
后端服务器可以运行任何支持TCP/IP的操作系统，包括Linux、各种Unix，Mac/OS和Windows等
负载调度器能支持绝大多数的TCP和UDP协议
性能：
LVS服务器集群系统具有良好的伸缩性，可支持几百万个并发连接。配置100M网卡，采用VS/TUN或VS/DR调度技术，
集群系统的吞吐量可高达1Gbits/s;如配置千兆网卡，则系统的最大吞吐量可达接近10Gbits/s
可靠性：
LVS服务器集群软件已经在很多大型的、关键性的站点得到很好的应用
软件许可证：
LVS集群软件是按GPL（GNU Public License）许可证发行的自由软件，这意味着你可以得到软件的源代码，有权对其进行修改，
但必须保证你的修改也是以GPL方式发行。

八、LVS与Nginx对比
负载均衡            4层负载均衡              7层负载均衡
技术原理            IP+TCP端口               URL应用层（内容交换）
典型代表            LVS                     Nginx、Haproxy、MySQL Proxy
